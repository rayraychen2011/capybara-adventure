# 農夫工作調度系統使用說明

## 概述

農夫工作調度系統實現了 50 名農夫在火車站 1 旁農地的集體工作管理，包括自動集合、傳送和工作時間限制。

## 系統功能

### 1. 農夫數量配置

- **50 名農夫**：負責在火車站 1 旁農地工作
- **49 名無職業居民**：在鎮上自由閒晃

### 2. 工作時間表

- **09:00-09:20**：集合階段 - 農夫到火車站前集合
- **09:20-17:00**：工作階段 - 農夫在農地工作，不能離開
- **17:00**：下班傳送 - 農夫集體傳送回火車站前
- **其他時間**：下班時間 - 農夫在鎮上自由活動

### 3. 傳送限制

- 農夫在工作時間（09:20-17:00）**不能傳送**
- 只有在卡住時才會進行緊急傳送
- 其他時間也限制傳送，保持真實性

## 系統組件

### 1. 核心文件

- `src/systems/npc/farmer_work_scheduler.py` - 農夫工作調度系統
- `src/utils/farmer_status_ui.py` - 農夫狀態顯示 UI
- `config/settings.py` - 農夫數量配置

### 2. 修改的文件

- `src/systems/npc/npc_manager.py` - 整合農夫調度系統
- `src/systems/npc/profession.py` - 更新職業數量
- `src/systems/npc/npc.py` - 添加農夫工作屬性
- `src/scenes/town/town_scene_refactored.py` - 整合 UI 和事件處理

## 使用方法

### 1. 遊戲內操作

- 按 **F1** 鍵：切換農夫狀態顯示 UI
- 按 **F2** 鍵：強制切換到集合階段（測試用）
- 按 **F3** 鍵：強制切換到工作階段（測試用）
- 按 **F4** 鍵：強制切換到下班階段（測試用）

### 2. 狀態監控

農夫狀態 UI 顯示：

- 當前時間和工作階段
- 各階段農夫數量統計
- 地圖上的農夫狀態標記

### 3. 地圖標記

- 🚜 - 工作中的農夫（綠色）
- 📍 - 集合中的農夫（黃色）
- 🏠 - 下班的農夫（灰色）

## 工作流程

### 每日工作循環

1. **早上 8:00 前**：農夫在鎮上自由活動
2. **9:00 整**：開始集合階段，農夫前往火車站前
3. **9:20 整**：工作階段開始，農夫集體傳送到農地
4. **9:20-17:00**：農夫在農地工作，受區域限制
5. **17:00 整**：下班傳送，農夫集體回到火車站前
6. **17:00 後**：下班時間，農夫自由活動

## 技術特點

### 1. 智能傳送

- 自動檢測火車站位置
- 計算農地工作區域邊界
- 安全位置驗證

### 2. 卡住檢測

- 監控農夫移動狀態
- 自動緊急傳送卡住的農夫
- 避免農夫消失

### 3. 區域限制

- 工作時間強制農夫在農地內
- 越界自動拉回工作區域
- 確保農夫不會亂跑

## 配置選項

### 農夫數量調整（config/settings.py）

```python
FARMER_COUNT = 50  # 農夫數量
OTHER_PROFESSIONS_COUNT = 49  # 其他居民數量
```

### 工作時間調整（src/systems/npc/profession.py）

```python
"work_start": 9,  # 開始集合時間
"work_end": 17,   # 結束工作時間
"transport_time": 9.33,  # 傳送時間（9:20）
```

## 測試功能

### 運行測試

```bash
python test_farmer_scheduler.py
```

### 測試內容

- 農夫創建和初始化
- 工作階段轉換
- 時間控制邏輯
- 狀態統計

## 故障排除

### 常見問題

1. **農夫不傳送**

   - 檢查火車站位置是否正確設定
   - 確認農地區域是否存在

2. **農夫卡住**

   - 系統會自動檢測並緊急傳送
   - 可以手動重置農夫位置

3. **時間不同步**
   - 確保時間管理器正常運作
   - 檢查工作階段轉換邏輯

### 調試資訊

系統會在控制台輸出：

- 工作階段轉換消息
- 傳送操作結果
- 農夫狀態變化

## 擴展功能

### 可能的改進

1. 添加農作物生長系統
2. 實現農夫工作效率統計
3. 增加天氣對農夫工作的影響
4. 添加農夫技能升級系統

### 自定義修改

開發者可以通過修改以下文件來自定義行為：

- 工作時間表：`profession.py`
- 傳送邏輯：`farmer_work_scheduler.py`
- UI 顯示：`farmer_status_ui.py`
