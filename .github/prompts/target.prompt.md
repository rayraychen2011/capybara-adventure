---
mode: agent
---

## 🎯 修改需求

### NPC 移動與建築放置規範

目的：確保 NPC 只在人行道與斑馬線上行走，且建築不會出現在馬路或人行道上。

1. NPC 行為規則

   - NPC 只能在「人行道」與「斑馬線」格子上行走，絕對不能在「車道/馬路」格子上行走或停留。
   - 每個路口必須存在斑馬線（crosswalk），NPC 僅能使用斑馬線穿越馬路。
   - NPC 的路徑搜尋（pathfinding）應僅把人行道與斑馬線標記為可通行節點；車道標記為不可通行。

2. 路口與斑馬線規範

   - 每個十字路口或 T 字路口需配置連接兩側人行道的斑馬線格列，形成從人行道到對側人行道的連通路徑。
   - 斑馬線格子在路徑搜尋中視為可通行，但要保留辨識屬性（例如 tile_type == "crosswalk"），以便日後擴充如等待與車流檢查。

3. 建築放置限制

   - 任何建築物不可放置在標記為「馬路」或「人行道」的格子上。
   - 放置邏輯需驗證目標格子與其周邊格子的 tile_type，若為 road 或 sidewalk 則拒絕放置。

4. 驗收標準（可用於測試）

   - 隨機生成 NPC 路徑：起點與終點均位於人行道，路徑應僅包含人行道與斑馬線格子，且能成功穿越所有必須跨越的馬路（透過斑馬線）。
   - 嘗試把建築放在人行道或馬路：系統應回傳錯誤或阻止放置。
   - 在場景中任意一個路口，能找到至少一條經過斑馬線的路徑連接兩側人行道。

5. 實作建議（簡要）
   - 使用格子地圖（tile map）並為每格設定 tile_type: "road" | "sidewalk" | "crosswalk" | "building"。
   - 在 pathfinding（如 A\*）時，將可通行節點限定為 tile_type in ["sidewalk","crosswalk"]，並加入 crosswalk 優先或權重設定以確保正確穿越路口。
   - 建築放置函式先檢查目標格子及影響範圍的 tile_type，若包含 "road" 或 "sidewalk" 就拒絕放置並回傳說明訊息。

### 額外要求

- 街區不要一格一格亂放人行道，請規劃好街區並確保人行道連接完整。
- 玩家操作應優化，使延遲維持在 0.03 秒以內。
